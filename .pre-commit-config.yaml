# Pre-commit hooks configuration
# https://pre-commit.com
#
# Install: pip install pre-commit (or: brew install pre-commit)
# Setup:   pre-commit install && pre-commit install --hook-type commit-msg
# Run all: pre-commit run --all-files
# Update:  pre-commit autoupdate

default_install_hook_types: [pre-commit, commit-msg]
default_stages: [pre-commit]

repos:
  # =============================================================================
  # Standard hooks - fast, universally useful
  # =============================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # Prevent large files from being committed (default 500KB)
      - id: check-added-large-files
        args: ['--maxkb=1024']  # 1MB limit

      # Check for merge conflict markers
      - id: check-merge-conflict

      # Validate YAML syntax
      - id: check-yaml
        args: ['--allow-multiple-documents']

      # Validate JSON syntax
      - id: check-json

      # Ensure files end with newline
      - id: end-of-file-fixer
        exclude: '\.min\.(js|css)$|\.wsr/reports/'

      # Remove trailing whitespace
      - id: trailing-whitespace
        exclude: '\.min\.(js|css)$|\.md$|\.wsr/reports/'

      # Prevent committing directly to main/master
      # Bypass with: git commit --no-verify -m "message"
      - id: no-commit-to-branch
        args: ['--branch', 'main', '--branch', 'master']

  # =============================================================================
  # Secret detection - CRITICAL for security
  # =============================================================================
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.18.4
    hooks:
      - id: gitleaks

  # =============================================================================
  # Custom hooks - Azure DevOps integration
  # =============================================================================
  - repo: local
    hooks:
      # Auto-link commits to Azure DevOps work items
      - id: ado-work-item-link
        name: ADO work item reference
        entry: python3 skills/azure-devops/scripts/commit_msg_hook.py
        language: system
        stages: [commit-msg]
        always_run: true

  # =============================================================================
  # .NET hooks (uncomment if working with .NET projects)
  # =============================================================================
  # - repo: local
  #   hooks:
  #     - id: dotnet-format
  #       name: dotnet format
  #       entry: dotnet format --verify-no-changes --verbosity minimal
  #       language: system
  #       types: [c#]
  #       pass_filenames: false
  #
  #     - id: dotnet-build
  #       name: dotnet build
  #       entry: dotnet build --no-restore -warnaserror
  #       language: system
  #       types: [c#]
  #       pass_filenames: false
  #       stages: [pre-push]

  # =============================================================================
  # Python hooks (uncomment if working with Python projects)
  # =============================================================================
  # - repo: https://github.com/psf/black
  #   rev: 24.3.0
  #   hooks:
  #     - id: black
  #
  # - repo: https://github.com/pycqa/isort
  #   rev: 5.13.2
  #   hooks:
  #     - id: isort
  #
  # - repo: https://github.com/pycqa/flake8
  #   rev: 7.0.0
  #   hooks:
  #     - id: flake8

  # =============================================================================
  # JavaScript/TypeScript hooks (uncomment if working with JS/TS projects)
  # =============================================================================
  # - repo: https://github.com/pre-commit/mirrors-eslint
  #   rev: v9.0.0
  #   hooks:
  #     - id: eslint
  #       types: [javascript, typescript]
  #       additional_dependencies:
  #         - eslint
  #         - typescript
  #
  # - repo: https://github.com/pre-commit/mirrors-prettier
  #   rev: v4.0.0-alpha.8
  #   hooks:
  #     - id: prettier
  #       types_or: [javascript, typescript, json, yaml, markdown]
