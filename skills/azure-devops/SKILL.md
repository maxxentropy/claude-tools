---
name: azure-devops
description: |
  Integrate with Azure DevOps for work item management, pipeline monitoring, and repository operations.
  Use when asked about: ado, azure devops, work item, create task, create bug, query work items, 
  pipeline, set up ado, my work items, sprint items, what did I complete.
  Requires: Azure CLI with devops extension, authentication via az login.
---

# Azure DevOps Integration

Integrate with Azure DevOps for work items, pipelines, and repositories using Azure CLI.

## Prerequisites Check

Before any ADO operation:

```bash
# 1. Check Azure CLI
az --version

# 2. Check DevOps extension
az extension show --name azure-devops
# If missing: az extension add --name azure-devops

# 3. Check authentication
az account show
# If not logged in: az login

# 4. Check project configuration
cat .ado/config.json 2>/dev/null || echo "NOT_CONFIGURED"
```

**If NOT_CONFIGURED â†’ Run Configuration Wizard below**

## Configuration Wizard

Run when `.ado/config.json` doesn't exist:

### Step 1: Get Organization URL
Ask user for Azure DevOps organization URL (e.g., `https://dev.azure.com/org-name`)

Validate:
```bash
az devops project list --organization "URL" --output table
```

### Step 2: Select Project
```bash
az devops project list --organization "URL" --query "[].name" --output tsv
```

### Step 3: Save Configuration
```bash
mkdir -p .ado
echo ".ado/" >> .gitignore
```

Create `.ado/config.json`:
```json
{
  "organization": "https://dev.azure.com/org-name",
  "project": "ProjectName",
  "configuredAt": "2024-01-15T10:30:00Z"
}
```

### Step 4: Run Discovery
```bash
python3 scripts/discover-project.py --config .ado/config.json --output .ado/project-metadata.json
```

## Common Operations

### Load Configuration
```bash
CONFIG=$(cat .ado/config.json)
ORG=$(echo $CONFIG | jq -r '.organization')
PROJECT=$(echo $CONFIG | jq -r '.project')
```

### Work Items

**Query my active items:**
```bash
az boards query --org "$ORG" --project "$PROJECT" \
  --wiql "SELECT [System.Id], [System.Title], [System.State] FROM workitems WHERE [System.AssignedTo] = @Me AND [System.State] <> 'Closed'" \
  --output table
```

**Query items changed this week:**
```bash
az boards query --org "$ORG" --project "$PROJECT" \
  --wiql "SELECT [System.Id], [System.Title] FROM workitems WHERE [System.AssignedTo] = @Me AND [System.ChangedDate] >= @Today - 7" \
  --output json
```

**Get work item details:**
```bash
az boards work-item show --org "$ORG" --id ITEM_ID --output json
```

**Create work item:**
```bash
az boards work-item create --org "$ORG" --project "$PROJECT" \
  --type "Task" --title "Title" --assigned-to "user@email.com" \
  --output json
```

**Update work item:**
```bash
az boards work-item update --org "$ORG" --id ITEM_ID --state "Active" --output json
```

### Pipelines

**List pipelines:**
```bash
az pipelines list --org "$ORG" --project "$PROJECT" --output table
```

**Recent runs:**
```bash
az pipelines runs list --org "$ORG" --project "$PROJECT" --pipeline-ids ID --top 10 --output table
```

**Trigger pipeline:**
```bash
az pipelines run --org "$ORG" --project "$PROJECT" --name "PipelineName" --branch "main"
```

### Repositories

**List repos:**
```bash
az repos list --org "$ORG" --project "$PROJECT" --output table
```

## Scripts

| Script | Purpose |
|--------|---------|
| `scripts/check-prerequisites.py` | Verify CLI and authentication |
| `scripts/discover-project.py` | Scan project structure (areas, iterations, teams) |
| `scripts/query-work-items.py` | Query with presets or custom WIQL |

### Query Presets

```bash
python3 scripts/query-work-items.py --config .ado/config.json --preset my-active
python3 scripts/query-work-items.py --config .ado/config.json --preset changed-this-week
python3 scripts/query-work-items.py --config .ado/config.json --preset completed-this-week
```

Available presets: `my-active`, `my-all`, `changed-today`, `changed-this-week`, `completed-this-week`, `recent-bugs`, `sprint-items`, `blocked`

## WIQL Quick Reference

```sql
-- My active items
SELECT [System.Id], [System.Title] FROM workitems
WHERE [System.AssignedTo] = @Me AND [System.State] <> 'Closed'

-- Items changed this week
SELECT [System.Id], [System.Title] FROM workitems
WHERE [System.ChangedDate] >= @Today - 7

-- Items in area path
SELECT [System.Id], [System.Title] FROM workitems
WHERE [System.AreaPath] UNDER 'Project\Area'
```

**Date macros:** `@Today`, `@Today - 7`, `@StartOfWeek`, `@StartOfMonth`

## Configuration Files

### .ado/config.json
```json
{
  "organization": "https://dev.azure.com/org-name",
  "project": "ProjectName",
  "configuredAt": "2024-01-15T10:30:00Z"
}
```

### .ado/project-metadata.json
Generated by `discover-project.py` with areas, iterations, teams, work item types, pipelines.
